<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session Manager final screen</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }

        body {
            background-color: #f8fafc;
            color: #334155;
            line-height: 1.5;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            opacity: 1;
            transition: none;
        }

        /* Prevent flicker on page load */
        body.loading {
            opacity: 0;
        }

        /* ===== TOP NAVBAR ===== */
        .top-nav {
            background: #3B82F6;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            height: 64px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            contain: layout style paint;
        }

        .top-nav .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            font-size: 16px;
            letter-spacing: 0.3px;
        }

        .top-nav .logo i {
            font-size: 24px;
        }

        .top-nav .job-pipeline {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 15px;
            background: rgba(255, 255, 255, 0.15);
            padding: 6px 16px;
            border-radius: 6px;
            margin-left: auto;
        }

        /* ===== MAIN LAYOUT ===== */
        .main-wrapper {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
            margin-top: 64px;
        }

        /* Anti-flicker: Ensure instant layout */
        .top-nav,
        .sidebar,
        .content-wrapper {
            will-change: auto;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
            contain: layout style;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            background: #ffffff;
            border-right: 1px solid #c0c0c2;
            padding: 16px 8px;
            width: 240px;
            overflow-y: auto;
            flex-shrink: 0;
            position: fixed;
            top: 64px;
            left: 0;
            bottom: 0;
            z-index: 900;
        }

        .nav-item {
            padding: 12px 16px;
            border-radius: 8px;
            color: #374151;
            cursor: pointer;
            margin-bottom: 4px;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s;
            user-select: none;
        }

        .nav-item i {
            margin-right: 12px;
            width: 18px;
            text-align: center;
        }

        .nav-item:hover {
            background: #f3f4f6;
            color: #1f2937;
        }

        .nav-item.active {
            background: #e0edff;
            color: #2563eb;
            font-weight: 600;
        }

        .nav-item.active .nav-label {
            font-weight: 600;
        }

        /* Submenu toggle */
        .nav-item .toggle-icon {
            transition: transform 0.2s;
            font-size: 12px;
            width: 16px;
            text-align: center;
            margin-left: auto;
            margin-right: -4px;
        }

        .nav-item.expanded .toggle-icon {
            transform: rotate(180deg);
        }

        .nav-submenu {
            display: none;
            flex-direction: column;
            background: #f9fafb;
            border-radius: 6px;
            margin-top: 4px;
            overflow: hidden;
        }

        .nav-submenu.show {
            display: flex;
        }

        .nav-submenu .nav-item {
            padding: 10px 16px 10px 40px;
            margin-bottom: 0;
            font-size: 13px;
            color: #64748b;
            font-weight: 400;
        }

        .nav-submenu .nav-item:hover {
            background: #eff6ff;
            color: #1e40af;
        }

        .nav-submenu .nav-item.active {
            background: #dbeafe;
            color: #1e40af;
            font-weight: 500;
        }

        /* ===== MAIN CONTENT ===== */
        .content-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            margin-left: 240px;
        }

        .container {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
        }

        /* Header Styles */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 0 0 20px;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 20px;
        }

        .page-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .page-subtitle {
            font-size: 13px;
            color: #6b7280;
            margin-bottom: 16px;
        }
        .header-left h1 {
            font-size: 28px;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 4px;
        }

        .header-left p {
            color: #64748b;
            font-size: 15px;
        }

        .btn-primary {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }

        .btn-primary:hover {
            background-color: #2563eb;
        }

        .btn-secondary {
            background-color: #f1f5f9;
            color: #475569;
            border: 1px solid #cbd5e1;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary:hover {
            background-color: #e2e8f0;
        }

        /* Search Bar */
        .search-section {
            margin-bottom: 24px;
        }

        .search-container {
            position: relative;
            max-width: 600px;
            margin-bottom: 16px;
        }

        .search-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-icon {
            position: absolute;
            left: 16px;
            color: #94a3b8;
            pointer-events: none;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px 12px 48px;
            border: 1px solid #cbd5e1;
            border-radius: 10px;
            font-size: 15px;
            background-color: white;
            transition: all 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .search-input::placeholder {
            color: #94a3b8;
        }

        .clear-search-btn {
            position: absolute;
            right: 12px;
            background: none;
            border: none;
            color: #94a3b8;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            opacity: 0;
            visibility: hidden;
        }

        .clear-search-btn:hover {
            background-color: #f1f5f9;
            color: #64748b;
        }

        .clear-search-btn.visible {
            opacity: 1;
            visibility: visible;
        }

        .search-stats {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 14px;
            color: #64748b;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .results-count {
            background-color: #3b82f6;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .search-query {
            font-weight: 500;
            color: #475569;
        }

        .clear-search-link {
            color: #3b82f6;
            text-decoration: none;
            cursor: pointer;
            transition: color 0.2s;
        }

        .clear-search-link:hover {
            color: #2563eb;
            text-decoration: underline;
        }

        /* Filter Controls */
        .controls-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .timeline-filter {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .timeline-btn {
            background-color: white;
            color: #64748b;
            border: 1px solid #e2e8f0;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .timeline-btn:hover {
            background-color: #f8fafc;
            border-color: #cbd5e1;
        }

        .timeline-btn.active {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .timeline-btn.active:hover {
            background-color: #2563eb;
            border-color: #2563eb;
        }

        .filter-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .filter-badge {
            background-color: #e2e8f0;
            color: #475569;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .filter-badge .remove {
            cursor: pointer;
            color: #94a3b8;
            transition: color 0.2s;
        }

        .filter-badge .remove:hover {
            color: #64748b;
        }

        /* Session List */
        .session-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* Session Card */
        .session-card {
            background-color: white;
            border-radius: 10px;
            padding: 16px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            transition: all 0.2s;
            position: relative;
        }

        .session-card:hover {
            border-color: #cbd5e1;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }

        .session-card.highlight {
            border-color: #3b82f6;
            background-color: #f0f9ff;
        }

        .session-content {
            flex: 1;
            min-width: 0; /* Prevents flex item from overflowing */
        }

        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            
        }

        .session-title-section {
            flex: 1;
            min-width: 0;
        }

        .session-title-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .session-title {
            font-size: 16px;
            font-weight: 600;
            color: #0f172a;
            cursor: pointer;
            transition: color 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 400px;
        }

        .session-title:hover {
            color: #3b82f6;
        }

        .session-schedule-badge {
            font-size: 11px;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 12px;
            background-color: #e0e7ff;
            color: #3730a3;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        /* Right-aligned timestamp */
        .session-timestamp {
            color: #94a3b8;
            font-size: 12px;
            text-align: right;
            white-space: nowrap;
            margin-left: 16px;
            padding-left: 16px;
            border-left: 1px solid #e2e8f0;
            height: 100%;
            display: flex;
            align-items: center;
        }

        .session-timestamp i {
            margin-right: 6px;
            font-size: 11px;
        }

        .session-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 6px; /* Reduced from 8px */
        }

        .lead-count {
            color: #475569;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .session-status {
            font-size: 11px;
            font-weight: 600;
          
            border-radius: 12px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .status-draft {
            background-color: #fef3c7;
            color: #92400e;
        }

        .status-processing {
            background-color: #dbeafe;
            color: #1e40af;
        }

        .status-ready {
            background-color: #d1fae5;
            color: #065f46;
        }

        .status-sent {
            background-color: #e0e7ff;
            color: #3730a3;
        }

        .status-archived {
            background-color: #f1f5f9;
            color: #475569;
        }

        .status-scheduled {
            background-color: #f3e8ff;
            color: #6b21a8;
        }

        .status-recurring {
            background-color: #f0f9ff;
            color: #0369a1;
        }

        .session-info-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 6px; /* Reduced from 8px */
        }

        .next-run {
            font-size: 12px;
            padding: 3px 8px;
            background-color: #dbe6f8;
            color: #3B82F6;
            border-radius: 10px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        /* Session Actions - UPDATED WITH TEXT BELOW */
        .session-actions {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 4px;
            margin-left: 16px;
            min-width: 60px;
        }

        .action-btn-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }

        .action-btn {
            background: none;
            border: none;
            color: #64748b;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .action-btn:hover {
            background-color: #f1f5f9;
            color: #0f172a;
        }

        .action-btn.primary {
            color: #3b82f6;
        }

        .action-btn.primary:hover {
            background-color: #dbeafe;
            color: #2563eb;
        }

        .action-btn-text {
            font-size: 10px;
            color: #64748b;
            text-align: center;
            white-space: nowrap;
            margin-top: 1px;
            font-weight: 500;
        }

        /* Schedule Status Indicator - REDUCED MARGIN */
        .schedule-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            color: #64748b;
            margin-top: 2px; /* Reduced from 4px */
        }

        /* Empty States */
        .empty-state {
            background-color: white;
            border-radius: 12px;
            padding: 48px 24px;
            text-align: center;
            border: 2px dashed #e2e8f0;
        }

        .empty-state-icon {
            font-size: 40px;
            color: #cbd5e1;
            margin-bottom: 16px;
        }

        .empty-state h3 {
            font-size: 18px;
            color: #0f172a;
            margin-bottom: 8px;
        }

        .empty-state p {
            color: #64748b;
            margin-bottom: 20px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .empty-state-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        /* Search-specific Empty State */
        .empty-search {
            text-align: center;
            padding: 40px 20px;
        }

        .empty-search-icon {
            font-size: 48px;
            color: #cbd5e1;
            margin-bottom: 16px;
        }

        .empty-search h3 {
            color: #475569;
            margin-bottom: 8px;
            font-size: 18px;
        }

        .empty-search p {
            color: #94a3b8;
            margin-bottom: 24px;
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: white;
            border-radius: 12px;
            padding: 28px;
            width: 100%;
            max-width: 520px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .modal h3 {
            font-size: 18px;
            color: #0f172a;
            margin-bottom: 20px;
        }

        .modal-section {
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
        }

        .modal-section:last-child {
            border-bottom: none;
        }

        .modal-section h4 {
            font-size: 16px;
            color: #334155;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-row {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #475569;
            margin-bottom: 6px;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-control:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 8px;
        }

        .radio-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .radio-label:hover {
            color: #3b82f6;
        }

        .radio-label input[type="radio"]:checked + span {
            color: #3b82f6;
            font-weight: 500;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 8px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .checkbox-label:hover {
            color: #3b82f6;
        }

        .days-of-week {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 8px;
        }

        .day-checkbox {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .day-checkbox input[type="checkbox"] {
            display: none;
        }

        .day-checkbox span {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            background-color: #f1f5f9;
            color: #64748b;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .day-checkbox input[type="checkbox"]:checked + span {
            background-color: #3b82f6;
            color: white;
        }

        .day-checkbox:hover span {
            background-color: #e2e8f0;
        }

        .day-checkbox input[type="checkbox"]:checked:hover + span {
            background-color: #2563eb;
        }

        .form-hint {
            font-size: 12px;
            color: #64748b;
            margin-top: 4px;
        }

        .form-error {
            font-size: 12px;
            color: #dc2626;
            margin-top: 4px;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 24px;
        }

        .btn-cancel {
            background-color: #f1f5f9;
            color: #475569;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-cancel:hover {
            background-color: #e2e8f0;
        }

        .btn-save {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-save:hover {
            background-color: #2563eb;
        }

        /* Schedule Summary */
        .schedule-summary {
            background-color: #f8fafc;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            font-size: 13px;
        }

        .schedule-summary h5 {
            color: #475569;
            margin-bottom: 6px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .schedule-summary p {
            color: #64748b;
            line-height: 1.4;
        }

        /* Loading State */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Utilities */
        .hidden {
            display: none !important;
        }

        .required::after {
            content: " *";
            color: #dc2626;
        }

        /* Search Highlight */
        .highlight-text {
            background-color: #fef3c7;
            padding: 0 2px;
            border-radius: 2px;
            color: #3b82f6;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .session-title {
                max-width: 300px;
            }
            
            .session-actions {
                min-width: 50px;
            }
        }

        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                gap: 16px;
            }
            
            .controls-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .session-header {
                flex-direction: column;
                gap: 8px;
            }
            
            .session-timestamp {
                border-left: none;
                padding-left: 0;
                margin-left: 0;
                text-align: left;
                justify-content: flex-start;
                width: 100%;
            }
            
            .session-actions {
                margin-left: 0;
                margin-top: 12px;
                width: 100%;
                justify-content: flex-end;
                flex-direction: row;
                gap: 16px;
            }
            
            .action-btn-wrapper {
                flex-direction: column;
                align-items: center;
            }
            
            .timeline-filter {
                justify-content: center;
            }
            
            .form-row {
                flex-direction: column;
                gap: 12px;
            }
            
            .modal {
                max-width: 95%;
                padding: 20px;
            }
            
            .session-title {
                max-width: 100%;
            }
        }

        @media (max-width: 480px) {
            .search-container {
                max-width: 100%;
            }
            
            .timeline-filter {
                gap: 4px;
            }
            
            .timeline-btn {
                padding: 6px 12px;
                font-size: 13px;
            }
            
            .session-card {
                padding: 12px;
            }
            
            .session-title-row {
                flex-wrap: wrap;
            }
            
            .session-meta {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .session-actions {
                gap: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Top Navigation Bar -->
    <nav class="top-nav">
        <div class="logo">
           <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" style="height: 40px;">
            
        </div>
    
    </nav>

    <!-- Main Layout -->
    <div class="main-wrapper">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <a href="/dashboard" class="nav-item">
                <div>
                    <i class="fas fa-chart-line"></i>
                    <span class="nav-label">Dashboard</span>
                </div>
            </a>

            <div class="nav-item active expanded" onclick="toggleSubmenu(this, event)">
                <div>
                    <i class="fas fa-search"></i>
                    <span class="nav-label">Lead Engine</span>
                </div>
                <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
            </div>
            <div class="nav-submenu show">
                <a href="/lead-engine" class="nav-item">
                    <span class="nav-label">Lead Search</span>
                </a>

                <a href="/session-manager" class="nav-item active">
                    <span class="nav-label">Session Manager</span>
                </a>
            </div>

            <!-- Campaign Manager with submenu -->
            <div class="nav-group">
                <div class="nav-item nav-group-header" onclick="toggleNavGroup(this)">
                    <i class="fas fa-users"></i>
                    <span>Campaign Manager</span>
                    <span class="nav-arrow">
                        <i class="fas fa-chevron-down"></i>
                    </span>
                </div>
                <div class="nav-submenu">
                    <a href="/campaign-manager/new" class="nav-item">
                        <span>Start New Campaign</span>
                    </a>
                    <a href="/campaign-manager" class="nav-item">
                        <span>Campaign Stats</span>
                    </a>
                    <a href="/campaign-manager/templates" class="nav-item">
                        <span>Email Templates</span>
                    </a>
                </div>
            </div>

            <a href="/response-manager" class="nav-item">
                <div>
                    <i class="fas fa-comments"></i>
                    <span class="nav-label">Response Manager</span>
                </div>
            </a>

            <a href="/analytics" class="nav-item">
                <div>
                    <i class="fas fa-chart-bar"></i>
                    <span class="nav-label">Analytics</span>
                </div>
            </a>

            <a href="/settings" class="nav-item">
                <div>
                    <i class="fas fa-cog"></i>
                    <span class="nav-label">Settings</span>
                </div>
            </a>
        </aside>

        <!-- Main Content -->
        <div class="content-wrapper">
            <div class="container">
                <!-- Page Header -->
                <header class="page-header">
                    <div class="header-left">
                        <h1 id="pageTitle">Session Manager</h1>
                        <p id="pageSubtitle">Manage automated lead generation sessions</p>
                    </div>
                    <div>
                        <button class="btn-primary" id="newSessionBtn">
                            <i class="fas fa-plus"></i> New Session
                        </button>
                    </div>
                </header>

                <!-- Search Section -->
                <div class="search-section">
                    <div class="search-container">
                        <div class="search-input-wrapper">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" 
                                   class="search-input" 
                                   id="searchInput" 
                                   placeholder="Search sessions by name, status, or region..."
                                   aria-label="Search sessions">
                            <button class="clear-search-btn" id="clearSearchBtn" aria-label="Clear search">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="search-stats hidden" id="searchStats">
                        <span class="results-count" id="resultsCount">0 results</span>
                        <span>for <span class="search-query" id="searchQuery"></span></span>
                        <a class="clear-search-link" id="clearSearchLink">Clear search</a>
                    </div>
                </div>

                <!-- Filter Controls -->
                <div class="controls-row">
                    <div class="timeline-filter">
                        <button class="timeline-btn active" data-period="today">Today</button>
                        <button class="timeline-btn" data-period="week">This Week</button>
                        <button class="timeline-btn" data-period="month">This Month</button>
                        <button class="timeline-btn" data-period="scheduled">Scheduled</button>
                        <button class="timeline-btn" data-period="all">All</button>
                    </div>
                    <div class="filter-badges hidden" id="filterBadges">
                        <!-- Active filters will appear here -->
                    </div>
                </div>

                <!-- Session List Container -->
                <div class="session-list" id="sessionList">
                    <!-- Sessions will be dynamically inserted here -->
                </div>

                <!-- Empty States -->
                <div class="empty-state hidden" id="emptyStateAll">
                    <div class="empty-state-icon">
                        <i class="fas fa-inbox"></i>
                    </div>
                    <h3>No sessions yet</h3>
                    <p>Create a session to start generating leads</p>
                    <div class="empty-state-actions">
                        <button class="btn-primary" id="emptyNewSessionBtn">
                            <i class="fas fa-plus"></i> New Session
                        </button>
                    </div>
                </div>

                <div class="empty-state hidden" id="emptyStateFiltered">
                    <div class="empty-state-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <h3>No sessions found</h3>
                    <p>No sessions found for this period</p>
                    <div class="empty-state-actions">
                        <button class="btn-secondary" id="switchTimelineBtn">Switch Timeline</button>
                        <button class="btn-primary" id="viewAllBtn">View All</button>
                    </div>
                </div>

                <!-- Search Empty State -->
                <div class="empty-search hidden" id="emptySearchState">
                    <div class="empty-search-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <h3>No matching sessions found</h3>
                    <p>Try adjusting your search or filters to find what you're looking for.</p>
                    <div class="empty-state-actions">
                        <button class="btn-secondary" id="clearSearchBtn2">Clear Search</button>
                        <button class="btn-primary" id="viewAllSessionsBtn">View All Sessions</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Session Modal -->
    <div class="modal-overlay" id="sessionModal">
        <div class="modal">
            <h3 id="modalTitle">Create New Session</h3>
            
            <!-- Basic Information Section -->
            <div class="modal-section">
                <h4><i class="fas fa-info-circle"></i> Basic Information</h4>
                
                <div class="form-group">
                    <label for="sessionName" class="required">Session Name</label>
                    <input type="text" id="sessionName" class="form-control" placeholder="Enter session name">
                    <div class="form-error hidden" id="nameError">Session name is required</div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="leadCount">Target Lead Count</label>
                        <input type="number" id="leadCount" class="form-control" value="100" min="1">
                        <div class="form-hint">Number of leads to generate</div>
                    </div>
                    <div class="form-group">
                        <label for="sessionRegion">Target Region</label>
                        <select id="sessionRegion" class="form-control">
                            <option value="global">Global</option>
                            <option value="us">United States</option>
                            <option value="europe">Europe</option>
                            <option value="asia">Asia</option>
                            <option value="uk">United Kingdom</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Scheduling Section -->
            <div class="modal-section">
                <h4><i class="fas fa-calendar-alt"></i> Scheduling & Recurrence</h4>
                
                <div class="form-group">
                    <label class="required">Run Type</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="runType" value="one-time" checked>
                            <span>One-time</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="runType" value="recurring">
                            <span>Recurring</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="startDate" class="required">Start Date</label>
                        <input type="date" id="startDate" class="form-control">
                        <div class="form-error hidden" id="dateError">Start date is required</div>
                    </div>
                    <div class="form-group">
                        <label for="startTime" class="required">Start Time</label>
                        <input type="time" id="startTime" class="form-control" value="09:00">
                    </div>
                </div>
                
                <!-- Recurrence Configuration -->
                <div id="recurrenceConfig" class="hidden">
                    <div class="form-group">
                        <label for="frequency" class="required">Repeat Every</label>
                        <select id="frequency" class="form-control">
                            <option value="daily">Day</option>
                            <option value="weekly">Week</option>
                            <option value="monthly">Month</option>
                        </select>
                    </div>
                    
                    <div id="weeklyConfig" class="form-group hidden">
                        <label class="required">Repeat On</label>
                        <div class="days-of-week">
                            <label class="day-checkbox">
                                <input type="checkbox" name="weekDays" value="0">
                                <span>Mon</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="weekDays" value="1">
                                <span>Tue</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="weekDays" value="2">
                                <span>Wed</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="weekDays" value="3">
                                <span>Thu</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="weekDays" value="4">
                                <span>Fri</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="weekDays" value="5">
                                <span>Sat</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="weekDays" value="6">
                                <span>Sun</span>
                            </label>
                        </div>
                        <div class="form-error hidden" id="daysError">Select at least one day</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="required">End Condition</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="endCondition" value="date" checked>
                                <span>End on date</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="endCondition" value="count">
                                <span>End after X runs</span>
                            </label>
                        </div>
                    </div>
                    
                    <div id="endDateConfig" class="form-group">
                        <label for="endDate">End Date</label>
                        <input type="date" id="endDate" class="form-control">
                    </div>
                    
                    <div id="endCountConfig" class="form-group hidden">
                        <label for="maxRuns">Number of Runs</label>
                        <input type="number" id="maxRuns" class="form-control" value="10" min="1">
                        <div class="form-hint">Total number of times to execute</div>
                    </div>
                </div>
                
                <!-- Schedule Summary -->
                <div class="schedule-summary hidden" id="scheduleSummary">
                    <h5>Schedule Summary</h5>
                    <p id="summaryText"></p>
                </div>
            </div>
            
            <!-- Modal Actions -->
            <div class="modal-actions">
                <button class="btn-cancel" id="cancelSessionBtn">Cancel</button>
                <button class="btn-save" id="saveSessionBtn">Create Session</button>
            </div>
        </div>
    </div>

    <!-- Rename Modal -->
    <div class="modal-overlay" id="renameModal">
        <div class="modal">
            <h3>Rename Session</h3>
            <div class="form-group">
                <label for="renameSessionName">Session Name</label>
                <input type="text" id="renameSessionName" class="form-control" placeholder="Enter session name">
            </div>
            <div class="modal-actions">
                <button class="btn-cancel" id="cancelRenameBtn">Cancel</button>
                <button class="btn-save" id="saveRenameBtn">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Archive Confirmation Modal -->
    <div class="modal-overlay" id="archiveModal">
        <div class="modal">
            <h3>Archive Session</h3>
            <p class="confirmation-text" id="archiveSessionName">Are you sure you want to archive this session?</p>
            <p class="confirmation-text">Archived sessions can be restored later.</p>
            <div class="modal-actions">
                <button class="btn-cancel" id="cancelArchiveBtn">Cancel</button>
                <button class="btn-save" id="confirmArchiveBtn">Archive Session</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="modal-overlay" id="loadingOverlay">
        <div class="modal">
            <div style="text-align: center; padding: 40px;">
                <div class="loading" style="margin: 0 auto 20px;"></div>
                <p>Loading session data...</p>
            </div>
        </div>
    </div>

    <script>
        // State management - sessions loaded from API
        let sessions = [];
        let currentFilter = 'today';
        let searchQuery = '';
        let sessionToEdit = null;
        let sessionToRename = null;
        let sessionToArchive = null;

        // DOM Elements
        const sessionList = document.getElementById('sessionList');
        const emptyStateAll = document.getElementById('emptyStateAll');
        const emptyStateFiltered = document.getElementById('emptyStateFiltered');
        const emptySearchState = document.getElementById('emptySearchState');
        const timelineButtons = document.querySelectorAll('.timeline-btn');
        const searchInput = document.getElementById('searchInput');
        const clearSearchBtn = document.getElementById('clearSearchBtn');
        const clearSearchLink = document.getElementById('clearSearchLink');
        const clearSearchBtn2 = document.getElementById('clearSearchBtn2');
        const searchStats = document.getElementById('searchStats');
        const resultsCount = document.getElementById('resultsCount');
        const searchQuerySpan = document.getElementById('searchQuery');
        const filterBadges = document.getElementById('filterBadges');
        const newSessionBtn = document.getElementById('newSessionBtn');
        const emptyNewSessionBtn = document.getElementById('emptyNewSessionBtn');
        const switchTimelineBtn = document.getElementById('switchTimelineBtn');
        const viewAllBtn = document.getElementById('viewAllBtn');
        const viewAllSessionsBtn = document.getElementById('viewAllSessionsBtn');
        const sessionModal = document.getElementById('sessionModal');
        const renameModal = document.getElementById('renameModal');
        const archiveModal = document.getElementById('archiveModal');
        const loadingOverlay = document.getElementById('loadingOverlay');
        
        // Session modal elements
        const modalTitle = document.getElementById('modalTitle');
        const sessionNameInput = document.getElementById('sessionName');
        const leadCountInput = document.getElementById('leadCount');
        const sessionRegionInput = document.getElementById('sessionRegion');
        const startDateInput = document.getElementById('startDate');
        const startTimeInput = document.getElementById('startTime');
        const runTypeRadios = document.querySelectorAll('input[name="runType"]');
        const recurrenceConfig = document.getElementById('recurrenceConfig');
        const frequencySelect = document.getElementById('frequency');
        const weeklyConfig = document.getElementById('weeklyConfig');
        const endConditionRadios = document.querySelectorAll('input[name="endCondition"]');
        const endDateConfig = document.getElementById('endDateConfig');
        const endDateInput = document.getElementById('endDate');
        const endCountConfig = document.getElementById('endCountConfig');
        const maxRunsInput = document.getElementById('maxRuns');
        const weekDayCheckboxes = document.querySelectorAll('input[name="weekDays"]');
        const scheduleSummary = document.getElementById('scheduleSummary');
        const summaryText = document.getElementById('summaryText');
        
        // Set default dates
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        
        startDateInput.value = tomorrow.toISOString().split('T')[0];
        
        const nextMonth = new Date(today);
        nextMonth.setMonth(nextMonth.getMonth() + 1);
        endDateInput.value = nextMonth.toISOString().split('T')[0];

        // Utility Functions
        function formatRelativeTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins} min ago`;
            if (diffHours < 24) return `${diffHours} hr ago`;
            if (diffDays < 7) return `${diffDays} day${diffDays === 1 ? '' : 's'} ago`;
            
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        function formatScheduleDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                weekday: 'short',
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function getStatusBadge(status, scheduleType) {
            const statusConfig = {
                'draft': { text: 'Draft', class: 'status-draft' },
                'processing': { text: 'Processing', class: 'status-processing' },
                'ready': { text: 'Ready', class: 'status-ready' },
                'sent': { text: 'Sent', class: 'status-sent' },
                'archived': { text: 'Archived', class: 'status-archived' },
                'scheduled': { text: 'Scheduled', class: 'status-scheduled' }
            };
            
            let badge = statusConfig[status] || statusConfig.draft;
            
            // Override status for scheduled sessions
            if (scheduleType === 'one-time' && new Date() < new Date(scheduleType?.startAt || 0)) {
                badge = statusConfig['scheduled'];
            }
            
            return badge;
        }

        function getNextRun(schedule) {
            if (!schedule || schedule.type === 'one-time') {
                return schedule?.startAt ? formatScheduleDate(schedule.startAt) : null;
            }
            
            // For recurring, calculate next run based on frequency
            const now = new Date();
            const startDate = new Date(schedule.startAt);
            
            if (schedule.recurrence.frequency === 'daily') {
                const daysSinceStart = Math.floor((now - startDate) / (1000 * 60 * 60 * 24));
                const nextRun = new Date(startDate);
                nextRun.setDate(nextRun.getDate() + (daysSinceStart + 1) * schedule.recurrence.interval);
                return formatScheduleDate(nextRun);
            }
            
            // Handle weekly schedules
            if (schedule.recurrence.frequency === 'weekly' && schedule.recurrence.daysOfWeek) {
                const today = now.getDay(); // 0 = Sunday, 1 = Monday, etc.
                const nextRun = new Date(now);
                
                // Find next scheduled day
                let daysToAdd = 0;
                let found = false;
                
                // Check next 7 days
                for (let i = 1; i <= 7; i++) {
                    const nextDay = (today + i) % 7;
                    if (schedule.recurrence.daysOfWeek.includes(nextDay)) {
                        daysToAdd = i;
                        found = true;
                        break;
                    }
                }
                
                if (found) {
                    nextRun.setDate(nextRun.getDate() + daysToAdd);
                    nextRun.setHours(startDate.getHours(), startDate.getMinutes(), 0, 0);
                    return formatScheduleDate(nextRun);
                }
            }
            
            // Simplified calculation for monthly (for demo)
            const nextRun = new Date(startDate);
            if (schedule.recurrence.frequency === 'monthly') {
                nextRun.setMonth(nextRun.getMonth() + 1);
            } else if (schedule.recurrence.frequency === 'weekly') {
                nextRun.setDate(nextRun.getDate() + 7);
            }
            
            return formatScheduleDate(nextRun);
        }

        function generateScheduleSummary(schedule) {
            if (!schedule) return 'No schedule configured';
            
            const startDate = new Date(schedule.startAt);
            const formattedStart = startDate.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            if (schedule.type === 'one-time') {
                return `One-time execution on ${formattedStart}`;
            }
            
            const recurrence = schedule.recurrence;
            let summary = `Recurring ${recurrence.frequency} starting ${formattedStart}`;
            
            if (recurrence.frequency === 'weekly' && recurrence.daysOfWeek) {
                const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
                const selectedDays = recurrence.daysOfWeek.map(d => days[d]).join(', ');
                summary += ` on ${selectedDays}`;
            }
            
            if (recurrence.endType === 'date' && recurrence.endDate) {
                const endDate = new Date(recurrence.endDate);
                summary += ` until ${endDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}`;
            } else if (recurrence.endType === 'count' && recurrence.maxRuns) {
                summary += ` for ${recurrence.maxRuns} runs`;
            }
            
            return summary;
        }

        // Search and Filter Functions
        function searchSessions(sessionsToSearch, query) {
            if (!query.trim()) return sessionsToSearch;
            
            const searchTerm = query.toLowerCase().trim();
            
            return sessionsToSearch.filter(session => {
                // Search in session name
                if (session.name.toLowerCase().includes(searchTerm)) return true;
                
                // Search in status
                if (session.status.toLowerCase().includes(searchTerm)) return true;
                
                // Search in schedule type
                if (session.schedule?.type?.toLowerCase().includes(searchTerm)) return true;
                
                // Search in status text
                const statusText = getStatusBadge(session.status, session.schedule?.type).text.toLowerCase();
                if (statusText.includes(searchTerm)) return true;
                
                // Search in lead count (exact match for numbers)
                if (session.lead_count.toString().includes(searchTerm)) return true;
                
                // Search for specific keywords
                if (searchTerm.includes('recurring') && session.schedule?.type === 'recurring') return true;
                if (searchTerm.includes('scheduled') && session.schedule?.type === 'one-time' && 
                    new Date() < new Date(session.schedule?.startAt || 0)) return true;
                if (searchTerm.includes('archived') && session.archived) return true;
                
                return false;
            });
        }

        function highlightSearchText(text, query) {
            if (!query.trim()) return text;
            
            const searchTerm = query.toLowerCase();
            const regex = new RegExp(`(${searchTerm})`, 'gi');
            
            return text.replace(regex, '<span class="highlight-text">$1</span>');
        }

        function filterSessionsByPeriod(period) {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            const monthAgo = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());

            let filtered = sessions.filter(session => {
                if (session.archived && period !== 'all') return false;
                
                const lastUpdated = new Date(session.last_updated_at);
                
                switch(period) {
                    case 'today':
                        return lastUpdated >= today;
                    case 'week':
                        return lastUpdated >= weekAgo;
                    case 'month':
                        return lastUpdated >= monthAgo;
                    case 'scheduled':
                        return !session.archived && session.schedule && 
                               new Date(session.schedule.startAt) > now;
                    case 'all':
                        return !session.archived;
                    default:
                        return true;
                }
            });
            
            // Apply search if there's a query
            if (searchQuery.trim()) {
                filtered = searchSessions(filtered, searchQuery);
            }
            
            return filtered;
        }

        function updateSearchUI(filteredCount, totalCount) {
            if (searchQuery.trim()) {
                searchStats.classList.remove('hidden');
                resultsCount.textContent = `${filteredCount} ${filteredCount === 1 ? 'result' : 'results'}`;
                searchQuerySpan.textContent = `"${searchQuery}"`;
                
                // Update filter badges
                updateFilterBadges();
                
                // Show/hide clear button
                clearSearchBtn.classList.add('visible');
            } else {
                searchStats.classList.add('hidden');
                clearSearchBtn.classList.remove('visible');
                filterBadges.classList.add('hidden');
            }
        }

        function updateFilterBadges() {
            filterBadges.innerHTML = '';
            
            if (searchQuery.trim()) {
                const searchBadge = document.createElement('div');
                searchBadge.className = 'filter-badge';
                searchBadge.innerHTML = `
                    <i class="fas fa-search"></i>
                    Search: "${searchQuery}"
                    <span class="remove" onclick="clearSearch()">
                        <i class="fas fa-times"></i>
                    </span>
                `;
                filterBadges.appendChild(searchBadge);
                filterBadges.classList.remove('hidden');
            }
            
            // Add timeline filter badge if not "all"
            if (currentFilter !== 'all') {
                const timelineLabels = {
                    'today': 'Today',
                    'week': 'This Week',
                    'month': 'This Month',
                    'scheduled': 'Scheduled'
                };
                
                const timelineBadge = document.createElement('div');
                timelineBadge.className = 'filter-badge';
                timelineBadge.innerHTML = `
                    <i class="fas fa-calendar-alt"></i>
                    ${timelineLabels[currentFilter]}
                    <span class="remove" onclick="clearTimelineFilter()">
                        <i class="fas fa-times"></i>
                    </span>
                `;
                filterBadges.appendChild(timelineBadge);
                filterBadges.classList.remove('hidden');
            }
        }

        function clearSearch() {
            searchInput.value = '';
            searchQuery = '';
            updateSearchUI(0, 0);
            renderSessions();
            searchInput.focus();
        }

        function clearTimelineFilter() {
            timelineButtons.forEach(btn => btn.classList.remove('active'));
            timelineButtons[4].classList.add('active'); // "All" button
            currentFilter = 'all';
            renderSessions();
        }

        // Validation Functions
        function validateSessionForm() {
            let isValid = true;
            
            // Reset errors
            document.querySelectorAll('.form-error').forEach(el => el.classList.add('hidden'));
            
            // Validate session name
            if (!sessionNameInput.value.trim()) {
                document.getElementById('nameError').classList.remove('hidden');
                isValid = false;
            }
            
            // Validate start date
            if (!startDateInput.value) {
                document.getElementById('dateError').classList.remove('hidden');
                isValid = false;
            }
            
            // Validate recurrence configuration
            const runType = document.querySelector('input[name="runType"]:checked').value;
            if (runType === 'recurring') {
                const frequency = frequencySelect.value;
                
                // Validate weekly days
                if (frequency === 'weekly') {
                    const hasDaySelected = Array.from(weekDayCheckboxes).some(cb => cb.checked);
                    if (!hasDaySelected) {
                        document.getElementById('daysError').classList.remove('hidden');
                        isValid = false;
                    }
                }
                
                // Validate end date
                const endCondition = document.querySelector('input[name="endCondition"]:checked').value;
                if (endCondition === 'date' && !endDateInput.value) {
                    endDateInput.style.borderColor = '#dc2626';
                    isValid = false;
                } else {
                    endDateInput.style.borderColor = '';
                }
                
                // Validate end count
                if (endCondition === 'count' && (!maxRunsInput.value || maxRunsInput.value < 1)) {
                    maxRunsInput.style.borderColor = '#dc2626';
                    isValid = false;
                } else {
                    maxRunsInput.style.borderColor = '';
                }
                
                // Validate end date is after start date
                if (endCondition === 'date' && endDateInput.value && startDateInput.value) {
                    const startDate = new Date(startDateInput.value);
                    const endDate = new Date(endDateInput.value);
                    if (endDate <= startDate) {
                        endDateInput.style.borderColor = '#dc2626';
                        isValid = false;
                    }
                }
            }
            
            return isValid;
        }

        // Render Functions - UPDATED WITH TEXT BELOW BUTTONS
        function renderSessions() {
            // Show loading
            loadingOverlay.classList.add('active');
            
            // Simulate API delay
            setTimeout(() => {
                let filteredSessions = filterSessionsByPeriod(currentFilter);
                
                // Clear current list
                sessionList.innerHTML = '';
                
                // Hide all empty states
                emptyStateAll.classList.add('hidden');
                emptyStateFiltered.classList.add('hidden');
                emptySearchState.classList.add('hidden');
                
                // Check if no sessions exist at all
                const activeSessions = sessions.filter(s => !s.archived);
                if (activeSessions.length === 0 && !searchQuery.trim()) {
                    emptyStateAll.classList.remove('hidden');
                    loadingOverlay.classList.remove('active');
                    return;
                }
                
                // Check if no sessions for current filter/search
                if (filteredSessions.length === 0) {
                    if (searchQuery.trim()) {
                        emptySearchState.classList.remove('hidden');
                    } else {
                        emptyStateFiltered.classList.remove('hidden');
                    }
                    loadingOverlay.classList.remove('active');
                    return;
                }
                
                // Update search UI
                updateSearchUI(filteredSessions.length, activeSessions.length);
                
                // Render each session
                filteredSessions.forEach(session => {
                    const status = getStatusBadge(session.status, session.schedule?.type);
                    const relativeTime = formatRelativeTime(session.last_updated_at);
                    const nextRun = session.schedule ? getNextRun(session.schedule) : null;
                    const hasSchedule = session.schedule && session.schedule.type;
                    
                    // Highlight search terms in session name
                    const highlightedName = searchQuery.trim() ? 
                        highlightSearchText(session.name, searchQuery) : session.name;
                    
                    const sessionCard = document.createElement('div');
                    sessionCard.className = `session-card ${searchQuery.trim() ? 'highlight' : ''}`;
                    sessionCard.dataset.id = session.id;
                    
                    // UPDATED HTML WITH TEXT BELOW BUTTONS
                    sessionCard.innerHTML = `
                        <div class="session-content">
                            <div class="session-header">
                                <div class="session-title-section">
                                    <div class="session-title-row">
                                        <div class="session-title" data-action="open">${highlightedName}</div>
                                        ${hasSchedule ? `
                                            <div class="session-schedule-badge">
                                                <i class="fas fa-clock"></i>
                                                ${session.schedule.type === 'recurring' ? 'Recurring' : 'Scheduled'}
                                            </div>
                                        ` : ''}
                                    </div>
                                    <div class="session-meta">
                                        <div class="lead-count">
                                            <i class="fas fa-users"></i>
                                            ${session.lead_count} leads
                                        </div>
                                        <span class="session-status ${status.class}">${status.text}</span>
                                    </div>
                                </div>
                               
                            </div>
                            
                            <div class="session-info-row">
                                ${nextRun ? `
                                    <span class="next-run" title="Next scheduled run">
                                         Next: ${nextRun}
                                    </span>
                                ` : ''}
                            </div>
                            
                            ${hasSchedule ? `
                                <div class="schedule-indicator">
                                    <i class="fas fa-calendar-alt"></i>
                                    ${generateScheduleSummary(session.schedule)}
                                </div>
                            ` : ''}
                        </div>
                    <div class="session-separator" style="margin-top: 10px; display:flex; justify-content: space-between; align-items: center; flex-direction: column; gap:4px;">
                        <div class="session-actions">
                            <div class="action-btn-wrapper">
                                <button class="action-btn primary" data-action="open" title="Open Session">
                                    <i class="fas fa-external-link-alt"></i>
                                </button>
                                <div class="action-btn-text">Open</div>
                            </div>
                            <div class="action-btn-wrapper">
                                <button class="action-btn" data-action="edit" title="Edit Session">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <div class="action-btn-text">Edit</div>
                            </div>
                            <div class="action-btn-wrapper">
                                <button class="action-btn" data-action="archive" title="Archive Session">
                                    <i class="fas fa-archive"></i>
                                </button>
                                <div class="action-btn-text">Archive</div>
                            </div>
                        </div>
                         <div class="session-timestamp" title="Last updated" style="font-size: 12px; color: #6b7280; margin-top: 8px;">
                                    <i class="far fa-clock"></i> Updated ${relativeTime}
                                </div>
                                </div>
                    `;
                    
                    sessionList.appendChild(sessionCard);
                });
                
                loadingOverlay.classList.remove('active');
            }, 300);
        }

        // Event Handlers
        function handleTimelineClick(e) {
            const period = e.target.dataset.period;
            
            // Update active button
            timelineButtons.forEach(btn => btn.classList.remove('active'));
            e.target.classList.add('active');
            
            // Update filter and render
            currentFilter = period;
            renderSessions();
        }

        function handleSessionAction(e) {
            const action = e.target.closest('[data-action]')?.dataset.action;
            const sessionCard = e.target.closest('.session-card');
            const sessionId = sessionCard?.dataset.id;
            
            if (!action || !sessionId) return;
            
            const session = sessions.find(s => s.id === sessionId);
            if (!session) return;
            
            switch(action) {
                case 'open':
                    openSession(session);
                    break;
                case 'edit':
                    openEditModal(session);
                    break;
                case 'archive':
                    openArchiveModal(session);
                    break;
            }
        }

        function openSession(session) {
            // Navigate to session detail page
            // Extract numeric ID from string ID (e.g., "sess_001" -> "1")
            let sessionId = session.id;
            if (typeof sessionId === 'string' && sessionId.includes('_')) {
                sessionId = parseInt(sessionId.split('_')[1]);
            }
            window.location.href = `/session/${sessionId}`;
        }

        function openSessionModal() {
            sessionToEdit = null;
            modalTitle.textContent = 'Create New Session';
            document.getElementById('saveSessionBtn').textContent = 'Create Session';
            
            // Reset form
            sessionNameInput.value = '';
            leadCountInput.value = '100';
            sessionRegionInput.value = 'global';
            
            // Set default dates
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            startDateInput.value = tomorrow.toISOString().split('T')[0];
            startTimeInput.value = '09:00';
            
            // Set default schedule
            runTypeRadios[0].checked = true;
            updateRecurrenceUI();
            
            // Clear errors
            document.querySelectorAll('.form-error').forEach(el => el.classList.add('hidden'));
            
            sessionModal.classList.add('active');
            sessionNameInput.focus();
        }

        function openEditModal(session) {
            sessionToEdit = session;
            modalTitle.textContent = 'Edit Session';
            document.getElementById('saveSessionBtn').textContent = 'Save Changes';
            
            // Populate form with session data
            sessionNameInput.value = session.name;
            leadCountInput.value = session.lead_count;
            sessionRegionInput.value = 'global'; // Default, could be extended
            
            if (session.schedule) {
                const startDate = new Date(session.schedule.startAt);
                startDateInput.value = startDate.toISOString().split('T')[0];
                startTimeInput.value = startDate.toTimeString().slice(0, 5);
                
                // Set run type
                const runTypeRadio = document.querySelector(`input[name="runType"][value="${session.schedule.type}"]`);
                if (runTypeRadio) runTypeRadio.checked = true;
                
                updateRecurrenceUI();
                
                if (session.schedule.type === 'recurring') {
                    const recurrence = session.schedule.recurrence;
                    frequencySelect.value = recurrence.frequency;
                    
                    if (recurrence.frequency === 'weekly' && recurrence.daysOfWeek) {
                        weekDayCheckboxes.forEach(cb => {
                            const dayValue = parseInt(cb.value);
                            cb.checked = recurrence.daysOfWeek.includes(dayValue);
                        });
                    }
                    
                    const endConditionRadio = document.querySelector(`input[name="endCondition"][value="${recurrence.endType}"]`);
                    if (endConditionRadio) endConditionRadio.checked = true;
                    
                    if (recurrence.endType === 'date' && recurrence.endDate) {
                        endDateInput.value = new Date(recurrence.endDate).toISOString().split('T')[0];
                    } else if (recurrence.endType === 'count' && recurrence.maxRuns) {
                        maxRunsInput.value = recurrence.maxRuns;
                    }
                    
                    updateEndConditionUI();
                }
            } else {
                // Default to one-time
                runTypeRadios[0].checked = true;
                updateRecurrenceUI();
            }
            
            updateScheduleSummary();
            
            sessionModal.classList.add('active');
            sessionNameInput.focus();
        }

        function openRenameModal(session) {
            sessionToRename = session;
            document.getElementById('renameSessionName').value = session.name;
            renameModal.classList.add('active');
            document.getElementById('renameSessionName').focus();
        }

        function openArchiveModal(session) {
            sessionToArchive = session;
            document.getElementById('archiveSessionName').textContent = `Are you sure you want to archive "${session.name}"?`;
            archiveModal.classList.add('active');
        }

        function handleNewSession() {
            openSessionModal();
        }

        function updateRecurrenceUI() {
            const runType = document.querySelector('input[name="runType"]:checked').value;
            
            if (runType === 'recurring') {
                recurrenceConfig.classList.remove('hidden');
                updateFrequencyUI();
                updateScheduleSummary();
            } else {
                recurrenceConfig.classList.add('hidden');
                scheduleSummary.classList.remove('hidden');
                const schedule = {
                    type: 'one-time',
                    startAt: `${startDateInput.value}T${startTimeInput.value}:00Z`
                };
                summaryText.textContent = generateScheduleSummary(schedule);
            }
        }

        function updateFrequencyUI() {
            const frequency = frequencySelect.value;
            
            if (frequency === 'weekly') {
                weeklyConfig.classList.remove('hidden');
            } else {
                weeklyConfig.classList.add('hidden');
            }
            
            updateScheduleSummary();
        }

        function updateEndConditionUI() {
            const endCondition = document.querySelector('input[name="endCondition"]:checked').value;
            
            if (endCondition === 'date') {
                endDateConfig.classList.remove('hidden');
                endCountConfig.classList.add('hidden');
            } else {
                endDateConfig.classList.add('hidden');
                endCountConfig.classList.remove('hidden');
            }
            
            updateScheduleSummary();
        }

        function updateScheduleSummary() {
            const runType = document.querySelector('input[name="runType"]:checked').value;
            const startDate = startDateInput.value;
            const startTime = startTimeInput.value;
            
            if (!startDate || !startTime) {
                scheduleSummary.classList.add('hidden');
                return;
            }
            
            const schedule = {
                type: runType,
                startAt: `${startDate}T${startTime}:00Z`
            };
            
            if (runType === 'recurring') {
                const frequency = frequencySelect.value;
                const endCondition = document.querySelector('input[name="endCondition"]:checked').value;
                
                schedule.recurrence = {
                    frequency: frequency,
                    interval: 1,
                    daysOfWeek: frequency === 'weekly' ? 
                        Array.from(weekDayCheckboxes)
                            .filter(cb => cb.checked)
                            .map(cb => parseInt(cb.value)) : null,
                    endType: endCondition,
                    endDate: endCondition === 'date' ? `${endDateInput.value}T23:59:59Z` : null,
                    maxRuns: endCondition === 'count' ? parseInt(maxRunsInput.value) : null
                };
            }
            
            scheduleSummary.classList.remove('hidden');
            summaryText.textContent = generateScheduleSummary(schedule);
        }

        function saveSession() {
            if (!validateSessionForm()) return;
            
            const newSessionData = {
                id: sessionToEdit ? sessionToEdit.id : `sess_${Date.now()}`,
                name: sessionNameInput.value.trim(),
                lead_count: parseInt(leadCountInput.value),
                status: sessionToEdit ? sessionToEdit.status : 'draft',
                created_at: sessionToEdit ? sessionToEdit.created_at : new Date().toISOString(),
                last_updated_at: new Date().toISOString(),
                archived: false
            };
            
            // Build schedule object
            const runType = document.querySelector('input[name="runType"]:checked').value;
            const startDate = startDateInput.value;
            const startTime = startTimeInput.value;
            
            if (startDate && startTime) {
                newSessionData.schedule = {
                    type: runType,
                    startAt: `${startDate}T${startTime}:00Z`
                };
                
                if (runType === 'recurring') {
                    const frequency = frequencySelect.value;
                    const endCondition = document.querySelector('input[name="endCondition"]:checked').value;
                    
                    newSessionData.schedule.recurrence = {
                        frequency: frequency,
                        interval: 1,
                        daysOfWeek: frequency === 'weekly' ? 
                            Array.from(weekDayCheckboxes)
                                .filter(cb => cb.checked)
                                .map(cb => parseInt(cb.value)) : null,
                        endType: endCondition,
                        endDate: endCondition === 'date' ? `${endDateInput.value}T23:59:59Z` : null,
                        maxRuns: endCondition === 'count' ? parseInt(maxRunsInput.value) : null
                    };
                }
            }
            
            // Update or create session
            if (sessionToEdit) {
                const index = sessions.findIndex(s => s.id === sessionToEdit.id);
                if (index !== -1) {
                    sessions[index] = { ...sessions[index], ...newSessionData };
                }
            } else {
                sessions.unshift(newSessionData);
            }
            
            sessionModal.classList.remove('active');
            renderSessions();
        }

        // Search Event Handlers
        let searchTimeout;
        function handleSearchInput(e) {
            clearTimeout(searchTimeout);
            
            searchTimeout = setTimeout(() => {
                searchQuery = e.target.value.trim();
                renderSessions();
            }, 300);
        }

        // Event Listeners
        timelineButtons.forEach(btn => {
            btn.addEventListener('click', handleTimelineClick);
        });

        sessionList.addEventListener('click', handleSessionAction);

        // Search event listeners
        searchInput.addEventListener('input', handleSearchInput);
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                clearTimeout(searchTimeout);
                searchQuery = e.target.value.trim();
                renderSessions();
            }
        });
        
        clearSearchBtn.addEventListener('click', clearSearch);
        clearSearchLink.addEventListener('click', clearSearch);
        clearSearchBtn2.addEventListener('click', clearSearch);
        
        viewAllSessionsBtn.addEventListener('click', () => {
            clearSearch();
            clearTimelineFilter();
        });

        newSessionBtn.addEventListener('click', handleNewSession);
        emptyNewSessionBtn.addEventListener('click', handleNewSession);

        switchTimelineBtn.addEventListener('click', () => {
            timelineButtons.forEach(btn => btn.classList.remove('active'));
            timelineButtons[4].classList.add('active');
            currentFilter = 'all';
            renderSessions();
        });

        viewAllBtn.addEventListener('click', () => {
            timelineButtons.forEach(btn => btn.classList.remove('active'));
            timelineButtons[4].classList.add('active');
            currentFilter = 'all';
            renderSessions();
        });

        // Session Modal Events
        document.getElementById('cancelSessionBtn').addEventListener('click', () => {
            sessionModal.classList.remove('active');
            sessionToEdit = null;
        });

        document.getElementById('saveSessionBtn').addEventListener('click', saveSession);

        // Recurrence UI updates
        runTypeRadios.forEach(radio => {
            radio.addEventListener('change', updateRecurrenceUI);
        });

        frequencySelect.addEventListener('change', updateFrequencyUI);
        
        weekDayCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', updateScheduleSummary);
        });

        endConditionRadios.forEach(radio => {
            radio.addEventListener('change', updateEndConditionUI);
        });

        [startDateInput, startTimeInput, endDateInput, maxRunsInput].forEach(input => {
            input.addEventListener('change', updateScheduleSummary);
        });

        // Rename Modal Events
        document.getElementById('cancelRenameBtn').addEventListener('click', () => {
            renameModal.classList.remove('active');
            sessionToRename = null;
        });

        document.getElementById('saveRenameBtn').addEventListener('click', () => {
            if (!sessionToRename || !document.getElementById('renameSessionName').value.trim()) return;
            
            sessionToRename.name = document.getElementById('renameSessionName').value.trim();
            sessionToRename.last_updated_at = new Date().toISOString();
            
            renameModal.classList.remove('active');
            renderSessions();
            sessionToRename = null;
        });

        // Archive Modal Events
        document.getElementById('cancelArchiveBtn').addEventListener('click', () => {
            archiveModal.classList.remove('active');
            sessionToArchive = null;
        });

        document.getElementById('confirmArchiveBtn').addEventListener('click', () => {
            if (!sessionToArchive) return;
            
            sessionToArchive.archived = true;
            sessionToArchive.last_updated_at = new Date().toISOString();
            
            archiveModal.classList.remove('active');
            renderSessions();
            sessionToArchive = null;
        });

        // Close modals on overlay click
        [sessionModal, renameModal, archiveModal].forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                    sessionToEdit = null;
                    sessionToRename = null;
                    sessionToArchive = null;
                }
            });
        });

        // Handle Enter key in modals
        sessionNameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                saveSession();
            }
        });

        document.getElementById('renameSessionName').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('saveRenameBtn').click();
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Set default dates
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            startDateInput.value = tomorrow.toISOString().split('T')[0];
            
            const nextMonth = new Date(today);
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            endDateInput.value = nextMonth.toISOString().split('T')[0];
            
            // Initial render
            renderSessions();
            
            // Focus search input on "/" key press
            document.addEventListener('keydown', (e) => {
                // Focus search on "/" key (except when in input/textarea)
                if (e.key === '/' && !['INPUT', 'TEXTAREA'].includes(e.target.tagName)) {
                    e.preventDefault();
                    searchInput.focus();
                }
                
                // Ctrl/Cmd + K for search
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    searchInput.focus();
                }
                
                // Ctrl/Cmd + N for new session
                if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                    e.preventDefault();
                    handleNewSession();
                }
                
                // Escape to close modals or clear search
                if (e.key === 'Escape') {
                    if (searchInput === document.activeElement && searchInput.value.trim()) {
                        clearSearch();
                    } else {
                        sessionModal.classList.remove('active');
                        renameModal.classList.remove('active');
                        archiveModal.classList.remove('active');
                    }
                }
            });
        });

        // ===== NAVIGATION FUNCTIONS =====
        function toggleSubmenu(element, event) {
            // Prevent navigation for expandable items
            if (element.querySelector('.toggle-icon')) {
                event?.preventDefault();
            }
            
            element.classList.toggle('expanded');
            const submenu = element.nextElementSibling;
            if (submenu && submenu.classList.contains('nav-submenu')) {
                submenu.classList.toggle('show');
            }
        }

        function navigateTo(page) {
            // Update page title and subtitle based on navigation
            const pageConfig = {
                'dashboard': {
                    title: 'Dashboard',
                    subtitle: 'Overview of your lead generation campaigns'
                },
                'lead-search': {
                    title: 'Lead Search',
                    subtitle: 'Search and discover new leads'
                },
                'session-manager': {
                    title: 'Session Manager',
                    subtitle: 'Manage automated lead generation sessions'
                },
                'campaign-manager': {
                    title: 'Campaign Manager',
                    subtitle: 'Manage and track your campaigns'
                },
                'response-manager': {
                    title: 'Response Manager',
                    subtitle: 'Track and manage lead responses'
                },
                'analytics': {
                    title: 'Analytics',
                    subtitle: 'View detailed analytics and insights'
                }
            };

            const config = pageConfig[page] || pageConfig['dashboard'];
            
            // Update page content
            document.getElementById('pageTitle').textContent = config.title;
            document.getElementById('pageSubtitle').textContent = config.subtitle;

            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // Find and highlight the clicked item
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                if (item.textContent.includes('Dashboard') && page === 'dashboard') {
                    item.classList.add('active');
                } else if (item.textContent.includes('Lead Search') && page === 'lead-search') {
                    item.classList.add('active');
                } else if (item.textContent.includes('Session Manager') && page === 'session-manager') {
                    item.classList.add('active');
                } else if (item.textContent.includes('Campaign Manager') && page === 'campaign-manager') {
                    item.classList.add('active');
                } else if (item.textContent.includes('Response Manager') && page === 'response-manager') {
                    item.classList.add('active');
                } else if (item.textContent.includes('Analytics') && page === 'analytics') {
                    item.classList.add('active');
                }
            });

            // Log navigation (in real app, this would load different content)
            console.log('Navigated to:', page);
        }
    </script>
</body>
</html>
